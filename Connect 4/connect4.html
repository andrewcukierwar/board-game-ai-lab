<!DOCTYPE html>
<html>
<head>
  <title>Connect4 Game</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    /* Existing styles */
    #game-board {
      width: 420px;
      height: 400px;
      display: grid;
      grid-template-columns: repeat(7, 60px);
      margin-top: 20px;
      border: 10px solid blue;
      background-color: blue;
    }
    .cell {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer; /* Indicate clickable cells */
    }
    .circle {
      width: 45px;
      height: 45px;
      border-radius: 50%;
    }
    .circle.x {
      background-color: red;
    }
    .circle.o {
      background-color: yellow;
    }
    .circle.empty {
      background-color: white;
    }
    /* Disable cursor when game is over */
    .cell.disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }
    /* Message display */
    #message {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
    }
    /* Depth selection styles */
    #depth-selection {
      margin-bottom: 10px;
    }
    label {
      margin-right: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Depth Selection -->
  <div id="depth-selection">
    <label for="depth">AI Depth:</label>
    <select id="depth">
      <option value="1">1 (Very Easy)</option>
      <option value="2">2 (Easy)</option>
      <option value="3" selected>3 (Medium)</option>
      <option value="4">4 (Hard)</option>
      <option value="5">5 (Very Hard)</option>
      <option value="6">6 (Expert)</option>
    </select>
  </div>

  <!-- Start and Restart Buttons -->
  <button onclick="startGame()">Start Game</button>
  <button onclick="restartGame()" style="display: none;" id="restart-button">Restart Game</button>

  <!-- Message Display -->
  <div id="message"></div>

  <!-- Game Board -->
  <div id="game-board"></div>

  <script>
    let currentBoard = [];
    let gameOver = false; // Track game state

    async function startGame() {
      // Get the selected depth
      const depthSelect = document.getElementById('depth');
      const selectedDepth = parseInt(depthSelect.value, 10);

      // Optional: Disable depth selection and Start button during game
      depthSelect.disabled = true;
      document.querySelector('button[onclick="startGame()"]').disabled = true;

      try {
        const response = await axios.post('http://127.0.0.1:5001/start_game', { depth: selectedDepth });
        currentBoard = response.data.board;
        gameOver = false;
        document.getElementById('message').innerText = '';
        document.getElementById('restart-button').style.display = 'none';
        updateBoard(currentBoard);
      } catch (error) {
        console.error(error);
        alert('Error starting the game.');
        // Re-enable depth selection and Start button in case of error
        depthSelect.disabled = false;
        document.querySelector('button[onclick="startGame()"]').disabled = false;
      }
    }

    function updateBoard(board) {
      const gameBoard = document.getElementById('game-board');
      gameBoard.innerHTML = ''; // Clear existing board

      board.forEach((row, rowIndex) => {
        row.forEach((cell, colIndex) => {
          const cellElement = document.createElement('div');
          cellElement.className = 'cell';
          
          // Disable cell clicks if game is over
          if (gameOver) {
            cellElement.classList.add('disabled');
          }

          const circleElement = document.createElement('div');
          circleElement.className = 'circle';
          if (cell === 'X') {
            circleElement.classList.add('x');
          } else if (cell === 'O') {
            circleElement.classList.add('o');
          } else {
            circleElement.classList.add('empty');
          }
          cellElement.appendChild(circleElement);
          
          // Assign click handler if game is not over
          if (!gameOver) {
            cellElement.onclick = () => makeMove(colIndex);
          }

          gameBoard.appendChild(cellElement);
        });
      });
    }

    async function makeMove(column) {
      if (gameOver) return; // Prevent moves if game is over

      try {
        const response = await axios.post('http://127.0.0.1:5001/make_move', { column });
        currentBoard = response.data.board;
        updateBoard(currentBoard);

        if (response.data.winner) {
          gameOver = true;
          let message = '';
          if (response.data.winner === 'Human') {
            message = 'You win!';
          } else if (response.data.winner === 'AI') {
            message = 'AI wins!';
          } else if (response.data.winner === 'Draw') {
            message = "It's a draw!";
          }

          // Delay the alert to allow DOM to update
          setTimeout(() => {
            alert('Game Over: ' + message);
            document.getElementById('message').innerText = message;
            document.getElementById('restart-button').style.display = 'inline-block';
            // Re-enable depth selection and Start button
            document.getElementById('depth').disabled = false;
            document.querySelector('button[onclick="startGame()"]').disabled = false;
          }, 100); // 100 milliseconds delay
          return;
        }

        // If it's AI's turn after player's move
        if (response.data.currentPlayer === 1 && response.data.checkWinner === -1) {
          await botMove();
        }
      } catch (error) {
        console.error(error);
        alert(error.response?.data?.error || 'Invalid move. Please try again.');
      }
    }

    async function botMove() {
      try {
        const response = await axios.post('http://127.0.0.1:5001/make_move');
        currentBoard = response.data.board;
        updateBoard(currentBoard);

        if (response.data.winner) {
          gameOver = true;
          let message = '';
          if (response.data.winner === 'Human') {
            message = 'You win!';
          } else if (response.data.winner === 'AI') {
            message = 'AI wins!';
          } else if (response.data.winner === 'Draw') {
            message = "It's a draw!";
          }

          // Delay the alert to allow DOM to update
          setTimeout(() => {
            alert('Game Over: ' + message);
            document.getElementById('message').innerText = message;
            document.getElementById('restart-button').style.display = 'inline-block';
            // Re-enable depth selection and Start button
            document.getElementById('depth').disabled = false;
            document.querySelector('button[onclick="startGame()"]').disabled = false;
          }, 100); // 100 milliseconds delay
        }
      } catch (error) {
        console.error(error);
      }
    }

    function restartGame() {
      startGame();
      document.getElementById('restart-button').style.display = 'none';
    }

    // Optionally, start the game automatically on page load
    // window.onload = startGame;
  </script>
</body>
</html>
